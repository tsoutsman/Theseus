<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Provides a `thread_local!()` macro, a helper to instantiate lazily-initialized  thread-local storage (TLS) variables."><meta name="keywords" content="rust, rustlang, rust-lang, thread_local_macro"><title>thread_local_macro - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceSerif4-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../FiraSans-Regular.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../FiraSans-Medium.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceCodePro-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceSerif4-Bold.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceCodePro-Semibold.ttf.woff2"><link rel="stylesheet" type="text/css" href="../normalize.css"><link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../ayu.css" disabled><link rel="stylesheet" type="text/css" href="../dark.css" disabled><link rel="stylesheet" type="text/css" href="../light.css" id="themeStyle"><script id="default-settings" ></script><script src="../storage.js"></script><script defer src="../crates.js"></script><script defer src="../main.js"></script><noscript><link rel="stylesheet" href="../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../favicon.svg"></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../thread_local_macro/index.html"><div class="logo-container"><img class="rust-logo" src="../rust-logo.svg" alt="logo"></div>
        </a><h2 class="location"></h2>
    </nav>
    <nav class="sidebar"><a class="sidebar-logo" href="../thread_local_macro/index.html"><div class="logo-container"><img class="rust-logo" src="../rust-logo.svg" alt="logo"></div>
        </a><h2 class="location"><a href="#">Crate thread_local_macro</a></h2><div class="sidebar-elems"><div class="block"><ul><li class="version">Version 0.1.0</li><li><a id="all-types" href="all.html">All Items</a></li></ul></div><section><div class="block"><ul><li><a href="#macros">Macros</a></li><li><a href="#structs">Structs</a></li></ul></div></section></div></nav><main><div class="width-limiter"><div class="sub-container"><a class="sub-logo-container" href="../thread_local_macro/index.html"><img class="rust-logo" src="../rust-logo.svg" alt="logo"></a><nav class="sub"><form class="search-form"><div class="search-container"><span></span><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><button type="button">?</button></div><div id="settings-menu" tabindex="-1">
                                <a href="../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../wheel.svg"></a></div>
                        </div></form></nav></div><section id="main-content" class="content"><div class="main-heading">
    <h1 class="fqn"><span class="in-band">Crate <a class="mod" href="#">thread_local_macro</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span></h1><span class="out-of-band"><a class="srclink" href="../src/thread_local_macro/lib.rs.html#1-615">source</a> · <a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span></div><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Provides a <code>thread_local!()</code> macro, a helper to instantiate lazily-initialized 
thread-local storage (TLS) variables.</p>
<p>The primary difference between using this crate’s <code>thread_local!()</code> macro
and directly using the <code>#[thread_local]</code> attribute is that <code>static</code> items
tagged with the <code>#[thread_local]</code> attribute will <em>never</em> be dropped,
just like all other <code>static</code>s.</p>
<p>However, static items defined in a <code>thread_local!()</code> macro block will be
destructed (e.g., dropped, destroyed) when that task exits.</p>
<h2 id="rust-std-based-implementation-notes"><a href="#rust-std-based-implementation-notes">Rust std-based implementation notes</a></h2>
<p>The code in this crate is adapted from <a href="https://github.com/rust-lang/rust/blob/3f14f4b3cec811017079564e16a92a1dc9870f41/library/std/src/thread/local.rs">this version of the <code>thread_local!()</code> macro</a>
from the Rust standard library.
The main design has been left unchanged, but we have removed most of the configuration blocks
for complex platform-specific or OS-specific behavior.
Because Theseus supports the <code>#[thread_local]</code> attribute, we can directly use the 
TLS “fast path”, which the Rust standard library refers to as the “FastLocalInnerKey”.</p>
<h3 id="unsafety"><a href="#unsafety">Unsafety</a></h3>
<p>We could probably could remove most of the unsafe code from this implementation,
because we don’t have to account for the various raw platform-specific interfaces 
or using raw libc types like the original Rust std implementation does.
However, I have chosen to leave the code as close as possible to the original 
Rust std implementation in order to make updates as easy as possible,
for if and when the Rust std version changes and we wish to track/merge in those changes.</p>
</div></details><h2 id="macros" class="small-section-header"><a href="#macros">Macros</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="macro" href="macro.thread_local.html" title="thread_local_macro::thread_local macro">thread_local</a></div><div class="item-right docblock-short"><p>Declare a new thread local storage key of type <a href="struct.LocalKey.html" title="LocalKey"><code>LocalKey</code></a>.</p>
</div></div></div><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.AccessError.html" title="thread_local_macro::AccessError struct">AccessError</a></div><div class="item-right docblock-short"><p>An error returned by <a href="struct.LocalKey.html#method.try_with"><code>LocalKey::try_with</code></a>.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.LocalKey.html" title="thread_local_macro::LocalKey struct">LocalKey</a></div><div class="item-right docblock-short"><p>A thread-local storage key which owns its contents.</p>
</div></div></div></section></div></main><div id="rustdoc-vars" data-root-path="../" data-current-crate="thread_local_macro" data-themes="ayu,dark,light" data-resource-suffix="" data-rustdoc-version="1.64.0-nightly (f8588549c 2022-07-18)" ></div>
</body></html>