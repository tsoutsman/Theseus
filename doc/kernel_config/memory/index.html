<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="WARNING: DO NOT USE ANY ADDRESS THAT MAPS TO THE SAME P4 ENTRY AS THE ONE USED FOR THE RECURSIVE PAGE TABLE ENTRY (CURRENTLY 510).  Currently, that would be any address that starts with 0xFFFF_FF0*********, so do not use that virtual address range for anything!! Current P4 (top-level page table) mappings:"><meta name="keywords" content="rust, rustlang, rust-lang, memory"><title>kernel_config::memory - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceSerif4-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../FiraSans-Regular.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../FiraSans-Medium.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceCodePro-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceSerif4-Bold.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceCodePro-Semibold.ttf.woff2"><link rel="stylesheet" href="../../normalize.css"><link rel="stylesheet" href="../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" href="../../ayu.css" disabled><link rel="stylesheet" href="../../dark.css" disabled><link rel="stylesheet" href="../../light.css" id="themeStyle"><script id="default-settings" ></script><script src="../../storage.js"></script><script defer src="../../main.js"></script><noscript><link rel="stylesheet" href="../../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../../favicon.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../../kernel_config/index.html"><div class="logo-container"><img class="rust-logo" src="../../rust-logo.svg" alt="logo"></div></a><h2></h2></nav><nav class="sidebar"><a class="sidebar-logo" href="../../kernel_config/index.html"><div class="logo-container"><img class="rust-logo" src="../../rust-logo.svg" alt="logo"></div></a><h2 class="location"><a href="#">Module memory</a></h2><div class="sidebar-elems"><section><ul class="block"><li><a href="#constants">Constants</a></li></ul></section></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../wheel.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1 class="fqn">Module <a href="../index.html">kernel_config</a>::<wbr><a class="mod" href="#">memory</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../../clipboard.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="srclink" href="../../src/kernel_config/memory.rs.html#1-103">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>WARNING: DO NOT USE ANY ADDRESS THAT MAPS TO THE SAME P4 ENTRY AS THE ONE
USED FOR THE RECURSIVE PAGE TABLE ENTRY (CURRENTLY 510). 
Currently, that would be any address that starts with 0xFFFF_FF0*<em>****</em>****,
so do not use that virtual address range for anything!!
Current P4 (top-level page table) mappings:</p>
<ul>
<li>511: kernel text sections</li>
<li>510: recursive mapping to top of P4</li>
<li>509: kernel heap</li>
<li>508: kernel stacks</li>
<li>507: userspace stacks</li>
<li>506 down to 0:  available for user processes</li>
</ul>
</div></details><h2 id="constants" class="small-section-header"><a href="#constants">Constants</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.ADDRESSABILITY_PER_P4_ENTRY.html" title="kernel_config::memory::ADDRESSABILITY_PER_P4_ENTRY constant">ADDRESSABILITY_PER_P4_ENTRY</a></div><div class="item-right docblock-short">Value: 512 GiB.</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.BYTES_PER_ADDR.html" title="kernel_config::memory::BYTES_PER_ADDR constant">BYTES_PER_ADDR</a></div><div class="item-right docblock-short">64-bit architecture results in 8 bytes per address.</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.ENTRIES_PER_PAGE_TABLE.html" title="kernel_config::memory::ENTRIES_PER_PAGE_TABLE constant">ENTRIES_PER_PAGE_TABLE</a></div><div class="item-right docblock-short">Value: 512. </div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.KERNEL_HEAP_INITIAL_SIZE.html" title="kernel_config::memory::KERNEL_HEAP_INITIAL_SIZE constant">KERNEL_HEAP_INITIAL_SIZE</a></div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.KERNEL_HEAP_MAX_SIZE.html" title="kernel_config::memory::KERNEL_HEAP_MAX_SIZE constant">KERNEL_HEAP_MAX_SIZE</a></div><div class="item-right docblock-short">the kernel heap gets the whole 509th P4 entry.</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.KERNEL_HEAP_P4_INDEX.html" title="kernel_config::memory::KERNEL_HEAP_P4_INDEX constant">KERNEL_HEAP_P4_INDEX</a></div><div class="item-right docblock-short">Value: 509. The 509th entry is used for the kernel heap</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.KERNEL_HEAP_START.html" title="kernel_config::memory::KERNEL_HEAP_START constant">KERNEL_HEAP_START</a></div><div class="item-right docblock-short">The higher-half heap gets the 512GB address range starting at the 509th P4 entry,
which is the slot right below the recursive P4 entry (510).
Actual value: 0o177777_775_000_000_000_0000, or 0xFFFF_FE80_0000_0000</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.KERNEL_OFFSET.html" title="kernel_config::memory::KERNEL_OFFSET constant">KERNEL_OFFSET</a></div><div class="item-right docblock-short">The virtual address where the initial kernel (the nano_core) is mapped to.
Actual value: 0xFFFFFFFF80000000.
i.e., the linear offset between physical memory and kernel memory.
So, for example, the VGA buffer will be mapped from 0xb8000 to 0xFFFFFFFF800b8000.
This is -2GiB from the end of the 64-bit address space.</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.KERNEL_STACK_ALLOCATOR_BOTTOM.html" title="kernel_config::memory::KERNEL_STACK_ALLOCATOR_BOTTOM constant">KERNEL_STACK_ALLOCATOR_BOTTOM</a></div><div class="item-right docblock-short">the kernel stack allocator gets the 508th P4 entry of addressability.
actual value: 0o177777_774_000_000_000_0000, or 0xFFFF_FE00_0000_0000 </div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.KERNEL_STACK_ALLOCATOR_TOP_ADDR.html" title="kernel_config::memory::KERNEL_STACK_ALLOCATOR_TOP_ADDR constant">KERNEL_STACK_ALLOCATOR_TOP_ADDR</a></div><div class="item-right docblock-short">the highest actually usuable address in the kernel stack allocator</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.KERNEL_STACK_P4_INDEX.html" title="kernel_config::memory::KERNEL_STACK_P4_INDEX constant">KERNEL_STACK_P4_INDEX</a></div><div class="item-right docblock-short">Value: 508. The 508th entry is used for all kernel stacks</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.KERNEL_STACK_SIZE_IN_PAGES.html" title="kernel_config::memory::KERNEL_STACK_SIZE_IN_PAGES constant">KERNEL_STACK_SIZE_IN_PAGES</a></div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.KERNEL_TEXT_MAX_SIZE.html" title="kernel_config::memory::KERNEL_TEXT_MAX_SIZE constant">KERNEL_TEXT_MAX_SIZE</a></div><div class="item-right docblock-short">The size in bytes, not in pages.</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.KERNEL_TEXT_P4_INDEX.html" title="kernel_config::memory::KERNEL_TEXT_P4_INDEX constant">KERNEL_TEXT_P4_INDEX</a></div><div class="item-right docblock-short">Value: 511. The 511th entry is used for kernel text sections</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.KERNEL_TEXT_START.html" title="kernel_config::memory::KERNEL_TEXT_START constant">KERNEL_TEXT_START</a></div><div class="item-right docblock-short">The kernel text region is where we load kernel modules. 
It starts at the 511th P4 entry and goes up until the KERNEL_OFFSET,
which is where the nano_core itself starts. 
Actual value: 0o177777_777_000_000_000_0000, or 0xFFFF_FF80_0000_0000</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.MAX_PAGE_NUMBER.html" title="kernel_config::memory::MAX_PAGE_NUMBER constant">MAX_PAGE_NUMBER</a></div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.MAX_VIRTUAL_ADDRESS.html" title="kernel_config::memory::MAX_VIRTUAL_ADDRESS constant">MAX_VIRTUAL_ADDRESS</a></div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.P1_INDEX_SHIFT.html" title="kernel_config::memory::P1_INDEX_SHIFT constant">P1_INDEX_SHIFT</a></div><div class="item-right docblock-short">Value: 0. Shift the Page number (not the address!) by this to get the P1 index.</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.P2_INDEX_SHIFT.html" title="kernel_config::memory::P2_INDEX_SHIFT constant">P2_INDEX_SHIFT</a></div><div class="item-right docblock-short">Value: 9. Shift the Page number (not the address!) by this to get the P2 index.</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.P3_INDEX_SHIFT.html" title="kernel_config::memory::P3_INDEX_SHIFT constant">P3_INDEX_SHIFT</a></div><div class="item-right docblock-short">Value: 18. Shift the Page number (not the address!) by this to get the P3 index.</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.P4_INDEX_SHIFT.html" title="kernel_config::memory::P4_INDEX_SHIFT constant">P4_INDEX_SHIFT</a></div><div class="item-right docblock-short">Value: 27. Shift the Page number (not the address!) by this to get the P4 index.</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.PAGE_SHIFT.html" title="kernel_config::memory::PAGE_SHIFT constant">PAGE_SHIFT</a></div><div class="item-right docblock-short">The lower 12 bits of a virtual address correspond to the P1 page frame offset. </div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.PAGE_SIZE.html" title="kernel_config::memory::PAGE_SIZE constant">PAGE_SIZE</a></div><div class="item-right docblock-short">Page size is 4096 bytes, 4KiB pages.</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.RECURSIVE_P4_INDEX.html" title="kernel_config::memory::RECURSIVE_P4_INDEX constant">RECURSIVE_P4_INDEX</a></div><div class="item-right docblock-short">Value: 510. The 510th entry is used for the recursive P4 mapping.</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.TEMPORARY_PAGE_VIRT_ADDR.html" title="kernel_config::memory::TEMPORARY_PAGE_VIRT_ADDR constant">TEMPORARY_PAGE_VIRT_ADDR</a></div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.USER_STACK_ALLOCATOR_BOTTOM.html" title="kernel_config::memory::USER_STACK_ALLOCATOR_BOTTOM constant">USER_STACK_ALLOCATOR_BOTTOM</a></div><div class="item-right docblock-short">the userspace stack allocators (one per userspace task) each get the 507th P4 entry of addressability.
actual value: 0o177777_773_000_000_000_0000, or 0xFFFF_FD80_0000_0000  </div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.USER_STACK_ALLOCATOR_TOP_ADDR.html" title="kernel_config::memory::USER_STACK_ALLOCATOR_TOP_ADDR constant">USER_STACK_ALLOCATOR_TOP_ADDR</a></div><div class="item-right docblock-short">the highest actually usuable address in each userspace stack allocator</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.USER_STACK_P4_INDEX.html" title="kernel_config::memory::USER_STACK_P4_INDEX constant">USER_STACK_P4_INDEX</a></div><div class="item-right docblock-short">Value: 507. The 507th entry is used for all userspace stacks</div></div></div></section></div></main><div id="rustdoc-vars" data-root-path="../../" data-current-crate="kernel_config" data-themes="ayu,dark,light" data-resource-suffix="" data-rustdoc-version="1.67.0-nightly (edf018221 2022-11-02)" ></div></body></html>