<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="This crate implements the main memory management subsystem for Theseus."><meta name="keywords" content="rust, rustlang, rust-lang, memory"><title>memory - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceSerif4-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../FiraSans-Regular.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../FiraSans-Medium.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceCodePro-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceSerif4-Bold.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceCodePro-Semibold.ttf.woff2"><link rel="stylesheet" href="../normalize.css"><link rel="stylesheet" href="../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" href="../ayu.css" disabled><link rel="stylesheet" href="../dark.css" disabled><link rel="stylesheet" href="../light.css" id="themeStyle"><script id="default-settings" ></script><script src="../storage.js"></script><script defer src="../crates.js"></script><script defer src="../main.js"></script><noscript><link rel="stylesheet" href="../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../favicon.svg"></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../memory/index.html"><div class="logo-container"><img class="rust-logo" src="../rust-logo.svg" alt="logo"></div></a><h2></h2></nav><nav class="sidebar"><a class="sidebar-logo" href="../memory/index.html"><div class="logo-container"><img class="rust-logo" src="../rust-logo.svg" alt="logo"></div></a><h2 class="location"><a href="#">Crate memory</a></h2><div class="sidebar-elems"><ul class="block"><li class="version">Version 0.1.0</li><li><a id="all-types" href="all.html">All Items</a></li></ul><section><ul class="block"><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#constants">Constants</a></li><li><a href="#traits">Traits</a></li><li><a href="#functions">Functions</a></li><li><a href="#types">Type Definitions</a></li></ul></section></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../wheel.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1 class="fqn">Crate <a class="mod" href="#">memory</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../clipboard.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="srclink" href="../src/memory/lib.rs.html#1-263">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>This crate implements the main memory management subsystem for Theseus.</p>
<p>The primary type of interest is <a href="struct.MappedPages.html" title="MappedPages"><code>MappedPages</code></a>, which offers a robust
interface that unifies the usage of arbitrary memory regions
with that of Rust’s safe type system and lifetimes.</p>
<h3 id="acknowledgments"><a href="#acknowledgments">Acknowledgments</a></h3>
<p>Some of the internal page table management code was based on
Philipp Oppermann’s <a href="https://github.com/phil-opp/blog_os">blog_os</a>, but has since changed significantly.</p>
</div></details><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.AllocatedFrames.html" title="memory::AllocatedFrames struct">AllocatedFrames</a></div><div class="item-right docblock-short">Represents a range of allocated physical memory <a href="struct.Frame.html" title="Frame"><code>Frame</code></a>s; derefs to <a href="struct.FrameRange.html" title="FrameRange"><code>FrameRange</code></a>.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.AllocatedPages.html" title="memory::AllocatedPages struct">AllocatedPages</a></div><div class="item-right docblock-short">Represents a range of allocated <code>VirtualAddress</code>es, specified in <code>Page</code>s. </div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.BorrowedMappedPages.html" title="memory::BorrowedMappedPages struct">BorrowedMappedPages</a></div><div class="item-right docblock-short">A borrowed <a href="struct.MappedPages.html" title="MappedPages"><code>MappedPages</code></a> object that derefs to <code>&amp;T</code> and optionally also <code>&amp;mut T</code>.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.BorrowedSliceMappedPages.html" title="memory::BorrowedSliceMappedPages struct">BorrowedSliceMappedPages</a></div><div class="item-right docblock-short">A borrowed <a href="struct.MappedPages.html" title="MappedPages"><code>MappedPages</code></a> object that derefs to a slice <code>&amp;[T]</code> and optionally also <code>&amp;mut [T]</code>.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.Frame.html" title="memory::Frame struct">Frame</a></div><div class="item-right docblock-short">A <code>Frame</code> is a chunk of <strong>physical</strong> memory aligned to a <a href="constant.PAGE_SIZE.html" title="PAGE_SIZE"><code>PAGE_SIZE</code></a> boundary.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.FrameRange.html" title="memory::FrameRange struct">FrameRange</a></div><div class="item-right docblock-short">A range of <a href="struct.Frame.html" title="Frame"><code>Frame</code></a>s that are contiguous in physical memory.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.Immutable.html" title="memory::Immutable struct">Immutable</a></div><div class="item-right docblock-short">A marker type used to indicate that a <a href="struct.BorrowedMappedPages.html" title="BorrowedMappedPages"><code>BorrowedMappedPages</code></a>
or <a href="struct.BorrowedSliceMappedPages.html" title="BorrowedSliceMappedPages"><code>BorrowedSliceMappedPages</code></a> is borrowed immutably.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.MappedPages.html" title="memory::MappedPages struct">MappedPages</a></div><div class="item-right docblock-short">Represents a contiguous range of virtual memory pages that are currently mapped. 
A <code>MappedPages</code> object can only have a single range of contiguous pages, not multiple disjoint ranges.
This does not guarantee that its pages are mapped to frames that are contiguous in physical memory.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.Mapper.html" title="memory::Mapper struct">Mapper</a></div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.MemoryManagementInfo.html" title="memory::MemoryManagementInfo struct">MemoryManagementInfo</a></div><div class="item-right docblock-short">This holds all the information for a <code>Task</code>’s memory mappings and address space
(this is basically the equivalent of Linux’s mm_struct)</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.Mutable.html" title="memory::Mutable struct">Mutable</a></div><div class="item-right docblock-short">A marker type used to indicate that a <a href="struct.BorrowedMappedPages.html" title="BorrowedMappedPages"><code>BorrowedMappedPages</code></a>
or <a href="struct.BorrowedSliceMappedPages.html" title="BorrowedSliceMappedPages"><code>BorrowedSliceMappedPages</code></a> is borrowed mutably.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.Page.html" title="memory::Page struct">Page</a></div><div class="item-right docblock-short">A <code>Page</code> is a chunk of <strong>virtual</strong> memory aligned to a <a href="constant.PAGE_SIZE.html" title="PAGE_SIZE"><code>PAGE_SIZE</code></a> boundary.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.PageRange.html" title="memory::PageRange struct">PageRange</a></div><div class="item-right docblock-short">A range of <a href="struct.Page.html" title="Page"><code>Page</code></a>s that are contiguous in virtual memory.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.PageTable.html" title="memory::PageTable struct">PageTable</a></div><div class="item-right docblock-short">A top-level root (P4) page table.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.PhysicalAddress.html" title="memory::PhysicalAddress struct">PhysicalAddress</a></div><div class="item-right docblock-short">A physical memory address, which is a <code>usize</code> under the hood.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.PhysicalMemoryRegion.html" title="memory::PhysicalMemoryRegion struct">PhysicalMemoryRegion</a></div><div class="item-right docblock-short">A region of physical memory.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.PteFlags.html" title="memory::PteFlags struct">PteFlags</a></div><div class="item-right docblock-short">Common, architecture-independent flags for a page table entry (PTE)
that define how a page is mapped.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.PteFlagsArch.html" title="memory::PteFlagsArch struct">PteFlagsArch</a><span class="stab portability" title="Available on x86-64 only">x86-64</span></div><div class="item-right docblock-short">Page table entry (PTE) flags on x86_64.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.PteFlagsX86_64.html" title="memory::PteFlagsX86_64 struct">PteFlagsX86_64</a><span class="stab portability" title="Available on x86-64 only">x86-64</span></div><div class="item-right docblock-short">Page table entry (PTE) flags on x86_64.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.VirtualAddress.html" title="memory::VirtualAddress struct">VirtualAddress</a></div><div class="item-right docblock-short">A virtual memory address, which is a <code>usize</code> under the hood.</div></div></div><h2 id="enums" class="small-section-header"><a href="#enums">Enums</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.MemoryRegionType.html" title="memory::MemoryRegionType enum">MemoryRegionType</a></div><div class="item-right docblock-short">Types of physical memory. See each variant’s documentation.</div></div></div><h2 id="constants" class="small-section-header"><a href="#constants">Constants</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.PAGE_SIZE.html" title="memory::PAGE_SIZE constant">PAGE_SIZE</a></div><div class="item-right docblock-short">Page size is 4096 bytes, 4KiB pages.</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.PTE_FRAME_MASK.html" title="memory::PTE_FRAME_MASK constant">PTE_FRAME_MASK</a></div><div class="item-right docblock-short">A mask for the bits of a page table entry that contain the physical frame address.</div></div></div><h2 id="traits" class="small-section-header"><a href="#traits">Traits</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="trait" href="trait.Mutability.html" title="memory::Mutability trait">Mutability</a></div><div class="item-right docblock-short">A trait for parameterizing a <a href="struct.BorrowedMappedPages.html" title="BorrowedMappedPages"><code>BorrowedMappedPages</code></a>
or <a href="struct.BorrowedSliceMappedPages.html" title="BorrowedSliceMappedPages"><code>BorrowedSliceMappedPages</code></a> as mutably or immutably borrowed.</div></div></div><h2 id="functions" class="small-section-header"><a href="#functions">Functions</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.allocate_frames.html" title="memory::allocate_frames fn">allocate_frames</a></div><div class="item-right docblock-short">Allocates the given number of frames with no constraints on the starting physical address.</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.allocate_frames_at.html" title="memory::allocate_frames_at fn">allocate_frames_at</a></div><div class="item-right docblock-short">Allocates the given number of frames starting at (inclusive of) the frame containing the given <code>PhysicalAddress</code>.</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.allocate_frames_by_bytes.html" title="memory::allocate_frames_by_bytes fn">allocate_frames_by_bytes</a></div><div class="item-right docblock-short">Allocates frames with no constraints on the starting physical address, 
with a size given by the number of bytes. </div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.allocate_frames_by_bytes_at.html" title="memory::allocate_frames_by_bytes_at fn">allocate_frames_by_bytes_at</a></div><div class="item-right docblock-short">Allocates frames starting at the given <code>PhysicalAddress</code> with a size given in number of bytes. </div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.allocate_pages.html" title="memory::allocate_pages fn">allocate_pages</a></div><div class="item-right docblock-short">Allocates the given number of pages with no constraints on the starting virtual address.</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.allocate_pages_at.html" title="memory::allocate_pages_at fn">allocate_pages_at</a></div><div class="item-right docblock-short">Allocates the given number of pages starting at (inclusive of) the page containing the given <code>VirtualAddress</code>.</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.allocate_pages_by_bytes.html" title="memory::allocate_pages_by_bytes fn">allocate_pages_by_bytes</a></div><div class="item-right docblock-short">Allocates pages with no constraints on the starting virtual address, 
with a size given by the number of bytes. </div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.allocate_pages_by_bytes_at.html" title="memory::allocate_pages_by_bytes_at fn">allocate_pages_by_bytes_at</a></div><div class="item-right docblock-short">Allocates pages starting at the given <code>VirtualAddress</code> with a size given in number of bytes. </div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.create_contiguous_mapping.html" title="memory::create_contiguous_mapping fn">create_contiguous_mapping</a></div><div class="item-right docblock-short">A convenience function that creates a new memory mapping by allocating frames that are contiguous in physical memory.
If contiguous frames are not required, then see <a href="fn.create_mapping.html"><code>create_mapping()</code></a>.
Returns a tuple containing the new <code>MappedPages</code> and the starting PhysicalAddress of the first frame,
which is a convenient way to get the physical address without walking the page tables.</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.create_mapping.html" title="memory::create_mapping fn">create_mapping</a></div><div class="item-right docblock-short">A convenience function that creates a new memory mapping. The pages allocated are contiguous in memory but there’s
no guarantee that the frames they are mapped to are also contiguous in memory. If contiguous frames are required
then see <a href="fn.create_contiguous_mapping.html"><code>create_contiguous_mapping()</code></a>.
Returns the new <code>MappedPages.</code> </div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.get_kernel_mmi_ref.html" title="memory::get_kernel_mmi_ref fn">get_kernel_mmi_ref</a></div><div class="item-right docblock-short">Returns a reference to the kernel’s <code>MemoryManagementInfo</code>, if initialized.
If not, it returns <code>None</code>.</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.init.html" title="memory::init fn">init</a></div><div class="item-right docblock-short">Initializes the virtual memory management system.
Consumes the given BootInformation, because after the memory system is initialized,
the original BootInformation will be unmapped and inaccessible.</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.init_post_heap.html" title="memory::init_post_heap fn">init_post_heap</a></div><div class="item-right docblock-short">Finishes initializing the memory management system after the heap is ready.</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.set_broadcast_tlb_shootdown_cb.html" title="memory::set_broadcast_tlb_shootdown_cb fn">set_broadcast_tlb_shootdown_cb</a></div><div class="item-right docblock-short">Set the function callback that will be invoked every time a TLB shootdown is necessary,
i.e., during page table remapping and unmapping operations.</div></div></div><h2 id="types" class="small-section-header"><a href="#types">Type Definitions</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="type" href="type.MmiRef.html" title="memory::MmiRef type">MmiRef</a></div><div class="item-right docblock-short">A shareable reference to a <code>MemoryManagementInfo</code> struct wrapper in a lock.</div></div></div></section></div></main><div id="rustdoc-vars" data-root-path="../" data-current-crate="memory" data-themes="ayu,dark,light" data-resource-suffix="" data-rustdoc-version="1.67.0-nightly (edf018221 2022-11-02)" ></div></body></html>