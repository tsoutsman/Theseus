<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="API documentation for the Rust `TlsInitializer` type in crate `local_storage_initializer`."><title>TlsInitializer in local_storage_initializer - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceSerif4-Bold-a2c9cd1067f8b328.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../static.files/rustdoc-9ee3a5e31a2afa3e.css"><meta name="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="local_storage_initializer" data-themes="" data-resource-suffix="" data-rustdoc-version="1.75.0-nightly (aa1a71e9e 2023-10-26)" data-channel="nightly" data-search-js="search-8fbf244ebcf71464.js" data-settings-js="settings-74424d7eec62a23e.js" ><script src="../static.files/storage-fec3eaa3851e447d.js"></script><script defer src="sidebar-items.js"></script><script defer src="../static.files/main-5f34af1a0ee6bacd.js"></script><noscript><link rel="stylesheet" href="../static.files/noscript-5d8b3c7633ad77ba.css"></noscript><link rel="alternate icon" type="image/png" href="../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc type"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../local_storage_initializer/index.html">local_storage_initializer</a><span class="version">0.1.0</span></h2></div><h2 class="location"><a href="#">TlsInitializer</a></h2><div class="sidebar-elems"><section><h3><a href="#aliased-type">Aliased type</a></h3><h3><a href="#implementations">Methods</a></h3><ul class="block"><li><a href="#method.add_existing_static_section">add_existing_static_section</a></li><li><a href="#method.add_new_dynamic_section">add_new_dynamic_section</a></li><li><a href="#method.get_data">get_data</a></li><li><a href="#method.invalidate">invalidate</a></li><li><a href="#method.new">new</a></li></ul><h3><a href="#trait-implementations">Trait Implementations</a></h3><ul class="block"><li><a href="#impl-Clone-for-LocalStorageInitializer%3CT%3E">Clone</a></li><li><a href="#impl-Debug-for-LocalStorageInitializer%3CT%3E">Debug</a></li></ul></section><h2><a href="index.html">In crate local_storage_initializer</a></h2></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Type Alias <a href="index.html">local_storage_initializer</a>::<wbr><a class="type" href="#">TlsInitializer</a><button id="copy-path" title="Copy item path to clipboard"><img src="../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="src" href="../src/local_storage_initializer/lib.rs.html#37">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><pre class="rust item-decl"><code>pub type TlsInitializer = <a class="struct" href="struct.LocalStorageInitializer.html" title="struct local_storage_initializer::LocalStorageInitializer">LocalStorageInitializer</a>&lt;<a class="struct" href="struct.Tls.html" title="struct local_storage_initializer::Tls">Tls</a>&gt;;</code></pre><h2 id="aliased-type" class="small-section-header">Aliased Type<a href="#aliased-type" class="anchor">§</a></h2><pre class="rust item-decl"><code>struct TlsInitializer { /* private fields */ }</code></pre><h2 id="implementations" class="small-section-header">Implementations<a href="#implementations" class="anchor">§</a></h2><div id="implementations-list"><details class="toggle implementors-toggle" open><summary><section id="impl-LocalStorageInitializer%3CT%3E" class="impl"><a class="src rightside" href="../src/local_storage_initializer/lib.rs.html#160-414">source</a><a href="#impl-LocalStorageInitializer%3CT%3E" class="anchor">§</a><h3 class="code-header">impl&lt;T&gt; <a class="struct" href="struct.LocalStorageInitializer.html" title="struct local_storage_initializer::LocalStorageInitializer">LocalStorageInitializer</a>&lt;T&gt;<span class="where fmt-newline">where
    T: <a class="trait" href="trait.LocalStorage.html" title="trait local_storage_initializer::LocalStorage">LocalStorage</a>,</span></h3></section></summary><div class="impl-items"><details class="toggle method-toggle" open><summary><section id="method.new" class="method"><a class="src rightside" href="../src/local_storage_initializer/lib.rs.html#165-176">source</a><h4 class="code-header">pub const fn <a href="#method.new" class="fn">new</a>() -&gt; Self</h4></section></summary><div class="docblock"><p>Creates an empty local storage initializer with no data sections.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.add_existing_static_section" class="method"><a class="src rightside" href="../src/local_storage_initializer/lib.rs.html#211-243">source</a><h4 class="code-header">pub fn <a href="#method.add_existing_static_section" class="fn">add_existing_static_section</a>(
    &amp;mut self,
    section: LoadedSection,
    offset: <a class="primitive" href="https://doc.rust-lang.org/nightly/core/primitive.usize.html">usize</a>,
    total_static_size: <a class="primitive" href="https://doc.rust-lang.org/nightly/core/primitive.usize.html">usize</a>
) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;StrongSectionRef, <a class="enum" href="enum.LocalStorageInitializerError.html" title="enum local_storage_initializer::LocalStorageInitializerError">LocalStorageInitializerError</a>&gt;</h4></section></summary><div class="docblock"><p>Add a CLS/TLS section that has pre-determined offset, e.g.,
one that was specified in the statically-linked base kernel image.</p>
<p>This function modifies the <code>tls_section</code>’s starting virtual address field
to hold the proper value such that this <code>tls_section</code> can be correctly used
as the source of a relocation calculation (e.g., when another section depends on it).</p>
<ul>
<li>On x86_64, that value will be the negative offset from the end of 
all the static TLS sections, i.e., where the TLS self pointer exists in memory,
to the start of this section in the TLS image.
<ul>
<li><code>VirtAddr = -1 * (total_static_tls_size - offset);</code></li>
</ul>
</li>
<li>On aarch64, that value will simply be the given <code>offset</code>.
<ul>
<li><code>VirtAddr = offset;</code>.</li>
<li>However, on aarch64, the actual <em>location</em> of this section in the TLS data image
is given by <code>offset + max(16, TLS_segment_align)</code>.
The ELF TLS ABI on aarch64 specifies that this augmented value is
the real offset used to <em>access</em> this TLS variable from the TLS base address
(from the beginning of all sections).</li>
</ul>
</li>
</ul>
<h6 id="arguments"><a href="#arguments">Arguments</a></h6>
<ul>
<li><code>section</code>: the section present in base kernel image.</li>
<li><code>offset</code>: the offset of this section as determined by the linker.
This corresponds to the “value” of this section’s symbol in the ELF file.</li>
<li><code>total_static_size</code>: the total size of all statically-known CLS/TLS sections,
including both TLS BSS (<code>.tbss</code>) and TLS data (<code>.tdata</code>) sections for TLS.</li>
</ul>
<h6 id="return"><a href="#return">Return</a></h6>
<ul>
<li>A reference to the newly added and properly modified section, if successful.</li>
<li>An error if inserting the given <code>tls_section</code> at the given <code>offset</code>
would overlap with an existing section. 
An error occurring here would indicate a link-time bug 
or a bug in the symbol parsing code that invokes this function.</li>
</ul>
</div></details><details class="toggle method-toggle" open><summary><section id="method.add_new_dynamic_section" class="method"><a class="src rightside" href="../src/local_storage_initializer/lib.rs.html#258-299">source</a><h4 class="code-header">pub fn <a href="#method.add_new_dynamic_section" class="fn">add_new_dynamic_section</a>(
    &amp;mut self,
    section: LoadedSection,
    alignment: <a class="primitive" href="https://doc.rust-lang.org/nightly/core/primitive.usize.html">usize</a>
) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;(<a class="primitive" href="https://doc.rust-lang.org/nightly/core/primitive.usize.html">usize</a>, StrongSectionRef), <a class="enum" href="enum.LocalStorageInitializerError.html" title="enum local_storage_initializer::LocalStorageInitializerError">LocalStorageInitializerError</a>&gt;</h4></section></summary><div class="docblock"><p>Inserts the given <code>section</code> into this CLS/TLS area at the next index
(i.e., offset into the CLS/TLS area) where the section will fit.</p>
<p>This also modifies the virtual address field of the given <code>section</code>
to hold the proper value based on that offset, which is necessary
for calculating relocation entries that depend on this section.</p>
<p>Returns a tuple of:</p>
<ol>
<li>The index at which the new section was inserted, 
which is the offset from the beginning of the CLS/TLS area where the section data starts.</li>
<li>The modified section as a <code>StrongSectionRef</code>.</li>
</ol>
<p>Returns an Error if there is no remaining space that can fit the section.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.invalidate" class="method"><a class="src rightside" href="../src/local_storage_initializer/lib.rs.html#306-308">source</a><h4 class="code-header">pub fn <a href="#method.invalidate" class="fn">invalidate</a>(&amp;mut self)</h4></section></summary><div class="docblock"><p>Invalidates the cached data image in this <code>LocalStorageInitializer</code> area.</p>
<p>This is useful for when a CLS/TLS section’s data has been modified,
e.g., while performing relocations, 
and thus the data image needs to be re-created by re-reading the section data.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.get_data" class="method"><a class="src rightside" href="../src/local_storage_initializer/lib.rs.html#313-413">source</a><h4 class="code-header">pub fn <a href="#method.get_data" class="fn">get_data</a>(&amp;mut self) -&gt; <a class="struct" href="struct.LocalStorageDataImage.html" title="struct local_storage_initializer::LocalStorageDataImage">LocalStorageDataImage</a>&lt;T&gt;</h4></section></summary><div class="docblock"><p>Returns a new copy of the data image.</p>
<p>This function lazily generates the image data on demand, if needed.</p>
</div></details></div></details></div><h2 id="trait-implementations" class="small-section-header">Trait Implementations<a href="#trait-implementations" class="anchor">§</a></h2><div id="trait-implementations-list"><details class="toggle implementors-toggle" open><summary><section id="impl-Clone-for-LocalStorageInitializer%3CT%3E" class="impl"><a class="src rightside" href="../src/local_storage_initializer/lib.rs.html#41">source</a><a href="#impl-Clone-for-LocalStorageInitializer%3CT%3E" class="anchor">§</a><h3 class="code-header">impl&lt;T&gt; <a class="trait" href="https://doc.rust-lang.org/nightly/core/clone/trait.Clone.html" title="trait core::clone::Clone">Clone</a> for <a class="struct" href="struct.LocalStorageInitializer.html" title="struct local_storage_initializer::LocalStorageInitializer">LocalStorageInitializer</a>&lt;T&gt;<span class="where fmt-newline">where
    T: <a class="trait" href="trait.LocalStorage.html" title="trait local_storage_initializer::LocalStorage">LocalStorage</a> + <a class="trait" href="https://doc.rust-lang.org/nightly/core/clone/trait.Clone.html" title="trait core::clone::Clone">Clone</a>,</span></h3></section></summary><div class="impl-items"><details class="toggle method-toggle" open><summary><section id="method.clone" class="method trait-impl"><a class="src rightside" href="../src/local_storage_initializer/lib.rs.html#41">source</a><a href="#method.clone" class="anchor">§</a><h4 class="code-header">fn <a href="https://doc.rust-lang.org/nightly/core/clone/trait.Clone.html#tymethod.clone" class="fn">clone</a>(&amp;self) -&gt; <a class="struct" href="struct.LocalStorageInitializer.html" title="struct local_storage_initializer::LocalStorageInitializer">LocalStorageInitializer</a>&lt;T&gt;</h4></section></summary><div class='docblock'>Returns a copy of the value. <a href="https://doc.rust-lang.org/nightly/core/clone/trait.Clone.html#tymethod.clone">Read more</a></div></details><details class="toggle method-toggle" open><summary><section id="method.clone_from" class="method trait-impl"><span class="rightside"><span class="since" title="Stable since Rust version 1.0.0">1.0.0</span> · <a class="src" href="https://doc.rust-lang.org/nightly/src/core/clone.rs.html#169">source</a></span><a href="#method.clone_from" class="anchor">§</a><h4 class="code-header">fn <a href="https://doc.rust-lang.org/nightly/core/clone/trait.Clone.html#method.clone_from" class="fn">clone_from</a>(&amp;mut self, source: <a class="primitive" href="https://doc.rust-lang.org/nightly/core/primitive.reference.html">&amp;Self</a>)</h4></section></summary><div class='docblock'>Performs copy-assignment from <code>source</code>. <a href="https://doc.rust-lang.org/nightly/core/clone/trait.Clone.html#method.clone_from">Read more</a></div></details></div></details><details class="toggle implementors-toggle" open><summary><section id="impl-Debug-for-LocalStorageInitializer%3CT%3E" class="impl"><a class="src rightside" href="../src/local_storage_initializer/lib.rs.html#41">source</a><a href="#impl-Debug-for-LocalStorageInitializer%3CT%3E" class="anchor">§</a><h3 class="code-header">impl&lt;T&gt; <a class="trait" href="https://doc.rust-lang.org/nightly/core/fmt/trait.Debug.html" title="trait core::fmt::Debug">Debug</a> for <a class="struct" href="struct.LocalStorageInitializer.html" title="struct local_storage_initializer::LocalStorageInitializer">LocalStorageInitializer</a>&lt;T&gt;<span class="where fmt-newline">where
    T: <a class="trait" href="trait.LocalStorage.html" title="trait local_storage_initializer::LocalStorage">LocalStorage</a> + <a class="trait" href="https://doc.rust-lang.org/nightly/core/fmt/trait.Debug.html" title="trait core::fmt::Debug">Debug</a>,</span></h3></section></summary><div class="impl-items"><details class="toggle method-toggle" open><summary><section id="method.fmt" class="method trait-impl"><a class="src rightside" href="../src/local_storage_initializer/lib.rs.html#41">source</a><a href="#method.fmt" class="anchor">§</a><h4 class="code-header">fn <a href="https://doc.rust-lang.org/nightly/core/fmt/trait.Debug.html#tymethod.fmt" class="fn">fmt</a>(&amp;self, f: &amp;mut <a class="struct" href="https://doc.rust-lang.org/nightly/core/fmt/struct.Formatter.html" title="struct core::fmt::Formatter">Formatter</a>&lt;'_&gt;) -&gt; <a class="type" href="https://doc.rust-lang.org/nightly/core/fmt/type.Result.html" title="type core::fmt::Result">Result</a></h4></section></summary><div class='docblock'>Formats the value using the given formatter. <a href="https://doc.rust-lang.org/nightly/core/fmt/trait.Debug.html#tymethod.fmt">Read more</a></div></details></div></details></div></section></div></main></body></html>